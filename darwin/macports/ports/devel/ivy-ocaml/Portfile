# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$
PortSystem              1.0
name                    ivy-ocaml
version                 r3571-2013.03.12
revision				2
categories              devel
platforms               darwin
maintainers             nomaintainer
description             Ivy bus ocaml library
long_description        Ivy is the software bus that will creep over your network!
homepage                http://www.tls.cena.fr/products/ivy/

depends_lib-append      port:ocaml-findlib \
						port:ocaml-ocamlnet \
                        port:ivy-c

worksrcdir              ${name}-r3571
fetch.type              svn
svn.url                 http://svn.tls.cena.fr/svn/ivy/ivy-ocaml/trunk
svn.revision            3571
svn.post_args-append    -r ${svn.revision} ${worksrcdir}

use_configure           no
#Need to prevent simultaneous targets building, error with -j4 default
use_parallel_build      no

build.post_args 		OSX_MACPORTS_PREFIX=${prefix}

pre-destroot {
        # ocamlfind needs the ocaml directory structure to be present
        # in order to fill it during installation.
        #xinstall -d ${destroot}${prefix}/lib/ocaml/site-lib/stublibs
        #system "export OCAMLFIND_DESTDIR=${destroot}`${prefix}/bin/ocamlc -where`/site-lib"
        #reinplace "s|#OCAMLFINDFLAGS += -destdir $(DESTDIR)|OCAMLFIND_DESTDIR=|g" ${worksrcpath}/Makefile
        set ocaml_site_path [exec ocamlfind printconf destdir]
	    xinstall -d ${destroot}${ocaml_site_path}/stublibs
	    destroot.args DESTDIR="${destroot}" OCAMLFIND_DESTDIR="${destroot}${ocaml_site_path}" COMPAT_SYMLINK_SRCMOD=site-lib/ OSX_MACPORTS_PREFIX=${prefix}
}

# Prepend the env var for use by makefile
#destroot.cmd	      export OCAMLFIND_DESTDIR="${destroot}`${prefix}/bin/ocamlfind -where`/site-lib"; ${build.cmd}
#destroot.post_args    DESTDIR=${destroot} OCAMLFIND_DESTDIR="${destroot}`${prefix}/bin/ocamlfind printconf destdir`" COMPAT_SYMLINK_SRCMOD=site-lib/ OSX_MACPORTS_PREFIX=${prefix}

#destroot.post_args    DESTDIR=${destroot} COMPAT_SYMLINK_SRCMOD=site-lib/ OSX_MACPORTS_PREFIX=${prefix}
