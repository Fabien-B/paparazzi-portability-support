# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$
PortSystem              1.0
name                    ivy-ocaml
version                 r3570-2013.02.28
revision				1
categories              devel
platforms               darwin
maintainers             nomaintainer
description             Ivy bus ocaml library
long_description        Ivy is the software bus that will creep over your network!
homepage                http://www.tls.cena.fr/products/ivy/

depends_lib-append      port:ocaml-ocamlnet \
                        port:ivy-c

worksrcdir              ${name}-r3570
fetch.type              svn
svn.url                 http://svn.tls.cena.fr/svn/ivy/ivy-ocaml/trunk
svn.revision            3570
svn.post_args-append    -r ${svn.revision} ${worksrcdir}

use_configure           no
#Need to prevent simultaneous targets building, error with -j4 default
use_parallel_build      no

pre-destroot {
        # ocamlfind needs the ocaml directory structure to be present
        # in order to fill it during installation.
        file mkdir "${destroot}${prefix}/lib/ocaml"
        file mkdir "${destroot}${prefix}/lib/ocaml/site-lib"
        file mkdir "${destroot}${prefix}/lib/ocaml/site-lib/stublibs"
        #file mkdir "${destroot}${prefix}/lib/ocaml/stublibs"
}

# Prepend the env var for use by makefile
destroot.cmd	      OCAMLFIND_DESTDIR="${destroot}`ocamlc -where`/site-lib" ${build.cmd}
destroot.post_args    DESTDIR=${destroot} COMPAT_SYMLINK_SRCMOD=site-lib/
